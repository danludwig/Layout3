var ViewModels;(function(n){(function(t){var i=function(){function t(){this._isInitialized=!1,this._activitiesViewModel=null,this._geographicExpertisesViewModel=null,this._languageExpertisesViewModel=null,this._degreesViewModel=null,this._affiliationsViewModel=null,this.hasPhoto=ko.observable(),this.isPhotoExtensionInvalid=ko.observable(!1),this.isPhotoTooManyBytes=ko.observable(!1),this.isPhotoFailureUnexpected=ko.observable(!1),this.photoFileExtension=ko.observable(),this.photoFileName=ko.observable(),this.photoSrc=ko.observable(App.Routes.WebApi.My.Profile.Photo.get({maxSide:128})),this.photoUploadSpinner=new n.Spinner(new n.SpinnerOptions(400)),this.photoDeleteSpinner=new n.Spinner(new n.SpinnerOptions(400)),this.isDisplayNameDerived=ko.observable(),this.displayName=ko.observable(),this._userDisplayName="",this.personId=0,this.salutation=ko.observable(),this.firstName=ko.observable(),this.middleName=ko.observable(),this.lastName=ko.observable(),this.suffix=ko.observable(),this.facultyRanks=ko.observableArray(),this.facultyRankId=ko.observable(),this.jobTitles=ko.observable(),this.administrativeAppointments=ko.observable(),this.gender=ko.observable(),this.isActive=ko.observable(),this.$photo=ko.observable(),this.$facultyRanks=ko.observable(),this.$nameSalutation=ko.observable(),this.$nameSuffix=ko.observable(),this.editMode=ko.observable(!1),this.saveSpinner=new n.Spinner(new n.SpinnerOptions(200)),this._initialize(),this._setupValidation(),this._setupKendoWidgets(),this._setupDisplayNameDerivation(),this._setupCardComputeds()}return t.prototype._initialize=function(){var n=this,i=$.Deferred(),t;$.get(App.Routes.WebApi.Employees.ModuleSettings.FacultyRanks.get()).done(function(n){i.resolve(n)}).fail(function(n,t,r){i.reject(n,t,r)}),t=$.Deferred(),$.get(App.Routes.WebApi.My.Profile.get()).done(function(n){t.resolve(n)}).fail(function(n,i,r){t.reject(n,i,r)}),$.when(i,t).then(function(t,i){n.facultyRanks(t),ko.mapping.fromJS(i,{ignore:"personId"},n),n.personId=i.personId,n._originalValues=i,n._isInitialized||($(n).trigger("ready"),n._isInitialized=!0,n.$facultyRanks().kendoDropDownList())},function(){})},t.prototype.startTab=function(t){var i=this;t==="Activities"||t==="activities"?this._activitiesViewModel==null&&(this._activitiesViewModel=new n.Activities.ActivityList(this.personId),this._activitiesViewModel.load().done(function(){ko.applyBindings(i._activitiesViewModel,$("#activities")[0])}).fail(function(n,t,i){alert(t+"|"+i)})):t==="Geographic Expertise"||t==="geographic-expertise"?this._geographicExpertisesViewModel==null&&(this._geographicExpertisesViewModel=new n.GeographicExpertises.GeographicExpertiseList(this.personId),this._geographicExpertisesViewModel.load().done(function(){ko.applyBindings(i._geographicExpertisesViewModel,$("#geographic-expertises")[0])}).fail(function(n,t,i){alert(t+"|"+i)})):t==="Language Expertise"||t==="language-expertise"||(t==="Formal Education"||t==="formal-education"?this._degreesViewModel==null&&(this._degreesViewModel=new n.Degrees.DegreeList(this.personId),this._degreesViewModel.load().done(function(){ko.applyBindings(i._degreesViewModel,$("#degrees")[0])}).fail(function(n,t,i){alert(t+"|"+i)})):t==="Affiliations"||t==="affiliations")},t.prototype.tabClickHandler=function(n){var t=n.item.innerText;t==null&&(t=n.item.textContent),this.startTab(t)},t.prototype.startEditing=function(){this.editMode(!0),this.$editSection.length&&this.$editSection.slideDown()},t.prototype.stopEditing=function(){this.editMode(!1),this.$editSection.length&&this.$editSection.slideUp()},t.prototype.cancelEditing=function(){ko.mapping.fromJS(this._originalValues,{},this),this.stopEditing()},t.prototype.saveInfo=function(){var n=this,t;this.isValid()?(t=ko.mapping.toJS(this),this.saveSpinner.start(),$.ajax({url:App.Routes.WebApi.My.Profile.put(),type:"PUT",data:t}).done(function(t){App.flasher.flash(t),n.stopEditing(),n._initialize()}).fail(function(){}).always(function(){n.saveSpinner.stop()})):this.errors.showAllMessages()},t.prototype.startDeletingPhoto=function(){var n=this;this.$confirmPurgeDialog&&this.$confirmPurgeDialog.length?this.$confirmPurgeDialog.dialog({dialogClass:"jquery-ui",width:"auto",resizable:!1,modal:!0,buttons:[{text:"Yes, confirm delete",click:function(){n.$confirmPurgeDialog.dialog("close"),n._deletePhoto()}},{text:"No, cancel delete",click:function(){n.$confirmPurgeDialog.dialog("close"),n.photoDeleteSpinner.stop()},"data-css-link":!0}]}):confirm("Are you sure you want to delete your profile photo?")&&this._deletePhoto()},t.prototype._deletePhoto=function(){var n=this;this.photoDeleteSpinner.start(),this.isPhotoExtensionInvalid(!1),this.isPhotoTooManyBytes(!1),this.isPhotoFailureUnexpected(!1),$.ajax({url:App.Routes.WebApi.My.Profile.Photo.del(),type:"DELETE"}).always(function(){n.photoDeleteSpinner.stop()}).done(function(t){typeof t=="string"&&App.flasher.flash(t),n.hasPhoto(!1),n.photoSrc(App.Routes.WebApi.My.Profile.Photo.get({maxSide:128,refresh:(new Date).toUTCString()}))}).fail(function(){n.isPhotoFailureUnexpected(!0)})},t.prototype._setupValidation=function(){this.displayName.extend({required:{message:"Display name is required."},maxLength:200}),this.salutation.extend({maxLength:50}),this.firstName.extend({maxLength:100}),this.middleName.extend({maxLength:100}),this.lastName.extend({maxLength:100}),this.suffix.extend({maxLength:50}),this.jobTitles.extend({maxLength:500}),this.administrativeAppointments.extend({maxLength:500}),ko.validation.group(this)},t.prototype._setupKendoWidgets=function(){var n=this;this.$nameSalutation.subscribe(function(n){n&&n.length&&n.kendoComboBox({dataTextField:"text",dataValueField:"value",dataSource:new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.People.Names.Salutations.get()}}})})}),this.$nameSuffix.subscribe(function(n){n&&n.length&&n.kendoComboBox({dataTextField:"text",dataValueField:"value",dataSource:new kendo.data.DataSource({transport:{read:{url:App.Routes.WebApi.People.Names.Suffixes.get()}}})})}),this.$photo.subscribe(function(t){t&&t.length&&t.kendoUpload({multiple:!1,showFileList:!1,localization:{select:"Choose a photo to upload..."},async:{saveUrl:App.Routes.WebApi.My.Profile.Photo.post(),removeUrl:App.Routes.WebApi.My.Profile.Photo.kendoRemove()},upload:function(t){var i=[".png",".jpg",".jpeg",".gif"];n.isPhotoExtensionInvalid(!1),n.isPhotoTooManyBytes(!1),n.isPhotoFailureUnexpected(!1),$(t.files).each(function(r){var f=!1,e=t.files[r].extension,u;for(n.photoFileExtension(e||"[NONE]"),n.photoFileName(t.files[r].name),u=0;u<i.length;u++)if(i[u]===e.toLowerCase()){f=!0;break}f?t.files[r].rawFile.size>1048576&&(t.preventDefault(),n.isPhotoTooManyBytes(!0)):(t.preventDefault(),n.isPhotoExtensionInvalid(!0))}),t.isDefaultPrevented()||n.photoUploadSpinner.start()},complete:function(){n.photoUploadSpinner.stop()},success:function(t){t.operation=="upload"&&(t.response&&t.response.message&&App.flasher.flash(t.response.message),n.hasPhoto(!0),n.photoSrc(App.Routes.WebApi.My.Profile.Photo.get({maxSide:128,refresh:(new Date).toUTCString()})))},error:function(t){var i,r;t.files&&t.files.length>0&&(i=t.files[0].name,r=t.files[0].extension),i&&n.photoFileName(i),r&&n.photoFileExtension(r),t.XMLHttpRequest.status===415?n.isPhotoExtensionInvalid(!0):t.XMLHttpRequest.status===413?n.isPhotoTooManyBytes(!0):n.isPhotoFailureUnexpected(!0)}})})},t.prototype._setupDisplayNameDerivation=function(){var n=this;this.displayName.subscribe(function(t){n.isDisplayNameDerived()||(n._userDisplayName=t)}),ko.computed(function(){if(n.isDisplayNameDerived()&&n._isInitialized){var t=ko.mapping.toJS(n);$.ajax({url:App.Routes.WebApi.People.Names.DeriveDisplayName.get(),type:"GET",cache:!1,data:t}).done(function(t){n.displayName(t)})}else n._isInitialized&&(n._userDisplayName||(n._userDisplayName=n.displayName()),n.displayName(n._userDisplayName))}).extend({throttle:400})},t.prototype._setupCardComputeds=function(){var n=this;this.genderText=ko.computed(function(){var t=n.gender();return t==="M"?"Male":t==="F"?"Female":t==="P"?"Gender Undisclosed":"Gender Unknown"}),this.isActiveText=ko.computed(function(){return n.isActive()?"Active":"Inactive"}),this.isFacultyRankEditable=ko.computed(function(){return n.facultyRanks()&&n.facultyRanks().length>0}),this.facultyRankText=ko.computed(function(){for(var r=n.facultyRankId(),i,t=0;t<n.facultyRanks().length;t++)if(i=n.facultyRanks()[t],r===i.id)return i.rank;return undefined}),this.isFacultyRankVisible=ko.computed(function(){return n.isFacultyRankEditable()&&n.facultyRankId()&&n.facultyRankText()&&n.facultyRankText().toLowerCase()!=="other"})},t}();t.Profile=i})(n.My||(n.My={}));var t=n.My})(ViewModels||(ViewModels={}))