var ViewModels;(function(n){(function(n){var t=function(){function n(n){this.inititializationErrors="",this.saving=!1,this.dirtyFlag=ko.observable(!1),this.initialLocations=[],this.selectedLocationValues=[],this._initialize(n)}return n.prototype._initialize=function(n){this.id=n==="new"?ko.observable(0):ko.observable(Number(n))},n.prototype.setupWidgets=function(n){var i=this,t;this.locationSelectorId=n,t=this,$("#"+n).kendoMultiSelect({autoBind:!0,dataTextField:"officialName",dataValueField:"id",minLength:3,dataSource:t.initialLocations,value:t.selectedLocationValues,change:function(n){i.updateLocations(n.sender.dataItems())},placeholder:"[Select Country/Location, Body of Water or Global]"})},n.prototype.setupValidation=function(){ko.validation.rules.atLeast={validator:function(n,t){return n.length>=t},message:"At least {0} must be selected."},ko.validation.registerExtenders(),this.locations.extend({atLeast:1}),this.description.extend({maxLength:400}),ko.validation.group(this)},n.prototype.load=function(){var n=this,t=$.Deferred(),i;return this.id()==0?(this.version=ko.observable(null),this.personId=ko.observable(0),this.description=ko.observable(null),this.locations=ko.observableArray(),this.whenLastUpdated=ko.observable(null),this.whoLastUpdated=ko.observable(null),t.resolve()):(i=$.Deferred(),$.ajax({type:"GET",url:App.Routes.WebApi.GeographicExpertises.get(this.id()),success:function(n){i.resolve(n)},error:function(n,t,r){i.reject(n,t,r)}}),$.when(i).done(function(i){ko.mapping.fromJS(i,{},n);for(var r=0;r<n.locations().length;r+=1)n.initialLocations.push({officialName:n.locations()[r].placeOfficialName(),id:n.locations()[r].placeId()}),n.selectedLocationValues.push(n.locations()[r].placeId());n.description.subscribe(function(){n.dirtyFlag(!0)}),t.resolve()}).fail(function(n,i,r){t.reject(n,i,r)})),t},n.prototype.save=function(n){var r=this,i,t;if(this.isValid()){while(this.saving)alert("Please wait while expertise is saved.");for(i={id:this.id,version:this.version,personId:this.personId,whenLastUpdated:this.whenLastUpdated,whoLastUpdated:this.whoLastUpdated,description:this.description,locations:ko.observableArray()},t=0;t<this.locations().length;t+=1)i.locations.push({id:this.locations()[t].id,version:this.locations()[t].version,whenLastUpdated:this.locations()[t].whenLastUpdated,whoLastUpdated:this.locations()[t].whoLastUpdated,expertiseId:this.locations()[t].expertiseId,placeOfficialName:this.locations()[t].placeOfficialName,placeId:this.locations()[t].placeId});var u=ko.mapping.toJS(i),f=n.id()==0?App.Routes.WebApi.GeographicExpertises.post():App.Routes.WebApi.GeographicExpertises.put(n.id()),e=n.id()==0?"POST":"PUT";this.saving=!0,$.ajax({type:e,url:f,data:u,dataType:"json",success:function(){r.saving=!1,location.href=App.Routes.Mvc.My.Profile.get(1)},error:function(n,t,i){r.saving=!1,alert(t+" | "+i),location.href=App.Routes.Mvc.My.Profile.get(1)}})}},n.prototype.cancel=function(){this.dirtyFlag()==!0?$("#cancelConfirmDialog").dialog({modal:!0,resizable:!1,width:450,buttons:{"Do not cancel":function(){$(this).dialog("close")},"Cancel and lose changes":function(){$(this).dialog("close"),location.href=App.Routes.Mvc.My.Profile.get(1)}}}):location.href=App.Routes.Mvc.My.Profile.get(1)},n.prototype.updateLocations=function(n){var t,i;for(this.locations.removeAll(),t=0;t<n.length;t+=1)i=ko.mapping.fromJS({id:0,placeId:n[t].id,version:""}),this.locations.push(i);this.dirtyFlag(!0)},n}();n.GeographicExpertise=t})(n.GeographicExpertises||(n.GeographicExpertises={}));var t=n.GeographicExpertises})(ViewModels||(ViewModels={}))