
<link rel="import" href="../../../Polymer/bower_components/core-selector/core-selector.html">
<link rel="import" href="../../../Polymer/bower_components/core-item/core-item.html">
<link rel="import" href="../../../Polymer/bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../Polymer/bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="../../../Polymer/bower_components/paper-input/paper-input-decorator.html">
<link rel="import" href="../../../Polymer/bower_components/core-input/core-input.html">
<link rel="import" href="../../../components/autoDDL/autoDDL.html">
<link rel="import" href="../../../components/CascadingDDL/cascading_DDL.html">
<link rel="import" href="../../../components/side_filter/side_filter.html">
<link rel="import" href="../../../Polymer/bower_components/core-localstorage/core-localstorage.html">
<script src="../../../Polymer/bower_components/page.js/page.js"></script>
<script src="../../../bower_components/firebase/firebase.js"></script>
<polymer-element name="is-page-summary-report" attributes="style_domain, tenant_id">
    <template>
        <link href="report.css" rel="stylesheet" />
        <div class="layout vertical">
            <header>
                <h2>
                    Summary Report
                </h2>
            </header>
            <div layout horizontal>
                <div flex style="margin-right:10px;">
                    <section style="position:relative;">
                        <h3 style="margin:0 0 4px 0;">Agreements</h3>
                        <div style=" font-size:1.2em;">
                            <template if="{{agreementTypeCountsLoaded && agreement_total_agreement_count > 0}}">
                                <template repeat="{{agreementTypeCount, agreementTypeCountI in agreementTypeCounts}}">
                                    <div style="margin-bottom:4px;">
                                        <b>{{agreementTypeCount.typeCount}}</b>
                                        <a href="/{{style_domain}}/agreements/#/table/country/{{selectedCountryCode}}/type/{{agreementTypeCount.type}}/sort/start-desc/size/10/page/1/keyword/*none*/ancestorId/{{establishment_search_url}}">{{agreementTypeCount.type}}</a>
                                        <!--<a href="/{{style_domain}}/agreements/#/table/country/{{selectedCountryCode}}/type/{{agreementTypeCount.type}}/sort/start-desc/size/10/page/1/keyword/{{ancestor}}">{{agreementTypeCount.type}}</a>-->
                                        <template if="{{agreementTypeCount.typeCount != 1}}">
                                            agreements
                                        </template>
                                        <template if="{{agreementTypeCount.typeCount == 1}}">
                                            agreement
                                        </template>
                                        in
                                        <b>{{agreementTypeCount.locationCount}}</b>
                                        <template if="{{agreementTypeCount.locationCount != 1}}">
                                            locations.
                                        </template>
                                        <template if="{{agreementTypeCount.locationCount == 1}}">
                                            location.
                                        </template>
                                    </div>
                                </template>
                                <div style="margin-top:12px;">
                                    <b>{{agreement_total_agreement_count}} <a href="/{{style_domain}}/agreements/#/table/country/{{selectedCountryCode}}/type/any/sort/start-desc/size/10/page/1/keyword/*none*/ancestorId/{{establishment_search_url}}">Total</a></b>
                                    <!--<b>{{agreement_total_agreement_count}} <a href="/{{style_domain}}/agreements/#/table/country/{{selectedCountryCode}}/type/any/sort/start-desc/size/10/page/1/keyword/{{ancestor}}">Total</a></b>-->
                                    <template if="{{agreement_total_agreement_count != 1}}">
                                        agreements
                                    </template>
                                    <template if="{{agreement_total_agreement_count == 1}}">
                                        agreement
                                    </template>
                                    in <b>{{agreement_total_location_count}}</b>
                                    <template if="{{agreement_total_location_count != 1}}">
                                        locations.
                                    </template>
                                    <template if="{{agreement_total_location_count == 1}}">
                                        location.
                                    </template>
                                </div>
                            </template>
                            <template if="{{agreementTypeCounts.length == 0 && agreementTypeCountsLoaded && establishmentSearch == ''}}">
                                <div>You do not have any agreements for the selected location</div>
                            </template>
                            <template if="{{agreementTypeCounts.length == 0 && agreementTypeCountsLoaded && establishmentSearch != ''}}">
                                <div>You do not have any agreements for the selected establishment</div>
                            </template>
                            <template if="{{!agreementTypeCountsLoaded}}">
                                <div>Loading...</div>
                            </template>
                        </div>
                    </section>

                    <section style="position:relative; ">
                        <h3 style="display:block; margin-bottom:4px;">Faculty & Staff Activities</h3>
                        <div style=" font-size:1.2em;">
                            <template if="{{activityTypeCountsLoaded && activity_total_activity_count > 0}}">
                                <template repeat="{{activityTypeCount, activityTypeCountI in activityTypeCounts}}">
                                    <div style="margin-bottom:4px;">
                                        <b>{{activityTypeCount.typeCount}}</b>
                                        <a onclick="sessionStorage.setItem('last_employee_activity_table_url', this.href)" href='/{{style_domain}}/employees/table/?activityTypeIds={{activityTypeCount.typeId}}&placeIds={{selectedPlaceId}}&placeNames={{selectedPlaceName}}&ancestorid={{establishment_search_url}}&keyword={{establishmentSearch}}&pageNumber=1&includeUndated=true'>{{activityTypeCount.type}}</a>
                                        <template if="{{activityTypeCount.typeCount != 1}}">
                                            activities
                                        </template>
                                        <template if="{{activityTypeCount.typeCount == 1}}">
                                            activity
                                        </template>
                                        from
                                        <b>{{activityTypeCount.personCount}}</b>
                                        <template if="{{activityTypeCount.personCount != 1}}">
                                            people
                                        </template>
                                        <template if="{{activityTypeCount.personCount == 1}}">
                                            person
                                        </template>
                                        in
                                        <b>{{activityTypeCount.locationCount}}</b>
                                        <template if="{{activityTypeCount.locationCount != 1}}">
                                            locations.
                                        </template>
                                        <template if="{{activityTypeCount.locationCount == 1}}">
                                            location.
                                        </template>
                                    </div>
                                </template>
                                <template if="{{activityTypeCounts.length != 0 && activityTypeCountsLoaded }}">
                                    <div style="margin-top:12px;">
                                        <b>{{activity_total_activity_count}} <a onclick="sessionStorage.setItem('last_employee_activity_table_url', this.href)" href='/{{style_domain}}/employees/table/?activityTypeIds=&placeIds={{selectedPlaceId}}&placeNames={{selectedPlaceName}}&ancestorid={{establishment_search_url}}&keyword={{establishmentSearch}}&pageNumber=1&includeUndated=true&activityTypeIds=2&activityTypeIds=3&activityTypeIds=5&activityTypeIds=1&activityTypeIds=4'>Total</a></b>
                                        <template if="{{activity_total_activity_count != 1}}">
                                            activities
                                        </template>
                                        <template if="{{activity_total_activity_count == 1}}">
                                            activity
                                        </template>
                                        from <b>{{activity_total_person_count}}</b>
                                        <template if="{{activity_total_person_count != 1}}">
                                            people
                                        </template>
                                        <template if="{{activity_total_person_count == 1}}">
                                            person
                                        </template>
                                        in <b>{{activity_total_location_count}}</b>
                                        <template if="{{activity_total_location_count != 1}}">
                                            locations.
                                        </template>
                                        <template if="{{activity_total_location_count == 1}}">
                                            location.
                                        </template>
                                    </div>
                                </template>
                            </template>
                            <template if="{{activityTypeCounts.length == 0 && activityTypeCountsLoaded }}">
                                <div>You do not have any activities for the selected filters</div>
                            </template>
                            <!--<template if="{{activityTypeCounts.length == 0 && activityTypeCountsLoaded}}">
                            <div>You do not have any activities for the selected establishment</div>
                        </template>-->
                            <template if="{{!activityTypeCountsLoaded}}">
                                <div>Loading...</div>
                            </template>
                        </div>
                    </section>

                    <section style="position:relative; ">
                        <h3 style="margin-bottom:4px;">Faculty & Staff Degrees</h3>
                        <div style=" font-size:1.2em;">
                            <template if="{{degrees.degreeCount != 0 && degreeCountsLoaded}}">
                                <template if="{{selectedCountryCode != 'any'}}">
                                    <a href='/{{style_domain}}/employees/degrees/table/?countryCode={{selectedCountryCode}}&keyword="{{establishmentSearch}}"&ancestorid={{establishment_search_url}}'>{{degrees.degreeCount}}</a>
                                </template>
                                <template if="{{selectedCountryCode == 'any'}}">
                                    <a href='/{{style_domain}}/employees/degrees/table/?keyword={{establishmentSearch}}&ancestorid={{establishment_search_url}}'>{{degrees.degreeCount}}</a>
                                </template>
                                <template if="{{degrees.degreeCount != 1}}">
                                    degrees
                                </template>
                                <template if="{{degrees.degreeCount == 1}}">
                                    degree
                                </template>
                                earned by
                                <b>{{degrees.personCount}}</b>
                                <template if="{{degrees.personCount != 1}}">
                                    people
                                </template>
                                <template if="{{degrees.personCount == 1}}">
                                    person
                                </template>
                                from
                                <b>{{degrees.establishmentCount}}</b>
                                <template if="{{degrees.establishmentCount != 1 }}">
                                    institutions
                                </template>
                                <template if="{{degrees.establishmentCount == 1}}">
                                    institution
                                </template>
                                in
                                <b>{{degrees.countryCount}}</b>
                                <template if="{{degrees.countryCount != 1}}">
                                    locations.
                                </template>
                                <template if="{{degrees.countryCount == 1}}">
                                    location.
                                </template>
                            </template>
                            <template if="{{degrees.degreeCount == 0 && degreeCountsLoaded}}">
                                <div>You do not have any degrees for the selected location</div>
                            </template>
                            <template if="{{!degreeCountsLoaded}}">
                                <div>Loading...</div>
                            </template>
                        </div>
                    </section>
                </div>
                <is-side-filter width="300px" has_space="true" style="z-index: 1;">
                    <is-cascading-ddl style="margin-top:0px;" id="cascading_ddl" new_id="{{new_tenant_id}}" list="{{affiliations}}" limit_id="{{tenant_id}}" place_holder="All sub-affiliations" layout_type="vertical">
                    </is-cascading-ddl>
                    <is-auto-ddl selected="{{selectedPlaceName}}" selectedid="{{selectedPlaceId}}" place_holder_text="Type and choose a country" on-selected-updated="{{selectCountry}}"
                                 list="{{countries}}" on-search-updated="{{filter_countries}}">
                    </is-auto-ddl>
                    <is-auto-ddl style="margin-bottom:2px;" selected="{{establishmentSearch}}" selectedid="{{selectedEstablishmentId}}" place_holder_text="Type and choose an institution" on-selected-updated="{{establishmentSelected}}"
                                 on-search-updated="{{establishmentListSearch}}" list="{{establishmentList}}">
                    </is-auto-ddl>
                </is-side-filter>
            </div>
        </div>

            <!--<div layout horizontal start style="width:1000px; z-index:1;">
            <is-cascading-ddl flex id="cascading_ddl2" new_id="{{new_tenant_id}}" list="{{affiliations}}" limit_id="{{tenant_id}}" place_holder="Select sub-affiliations" layout_type="horizontal">

            </is-cascading-ddl>
        </div>-->
            <!--<h3 style="margin-bottom:4px;">International Affiliations</h3>
        <template if="{{affiliations.affiliationCount.length != 0 && affiliationCountLoaded}}">
            <div>
                <b>{{affiliations.personCount}}</b>
                people with
                <b>{{affiliations.affiliationCount}}</b>
                Affiliations in
                <b>{{affiliations.establishmentCount}}</b> institutions.
            </div>
        </template>
        <template if="{{affiliations.affiliationCount.length == 0 && affiliationCountLoaded}}">
            <div>You do not have any international affiliations for the selected location</div>
        </template>
        <template if="{{!affiliationCountLoaded}}">
            <div>Loading...</div>
        </template>

        <h3 style="margin-bottom:4px;">Geograpic Expertises</h3>
        <template if="{{expertises.expertiseCount.length != 0 && expertiseCountLoaded}}">
            <div>
                <b>{{expertises.personCount}}</b>
                people with
                <b>{{expertises.expertiseCount}}</b>
                Expertises in
                <b>{{expertises.locationCount}}</b> locations.
            </div>
        </template>
        <template if="{{expertises.expertiseCount.length == 0 && expertiseCountLoaded}}">
            <div>You do not have any geograpic expertises for the selected location</div>
        </template>
        <template if="{{!expertiseCountLoaded}}">
            <div>Loading...</div>
        </template>-->
            <!--<core-ajax url="/api/home/section"
                   params='{"Description":"{{description}}",
                   "Links" "{{links}}" ,
                   "Title" "{{title}}" }'
                   handleas="json"
                   method="post"
                   on-core-response="{{addSectionResponse}}"
                   on-core-error="{{ajaxError}}"
                   id="ajax_addSection">
        </core-ajax>-->
            <!--<core-ajax url="/api/countries/"
                       headers='{"Accept": "application/json"}'
                       handleas="json" auto
                       on-core-response="{{countriesResponse}}"
                       on-core-error="{{ajaxError}}"
                       id="ajax_countries">
            </core-ajax>-->
            <core-ajax url="/api/summary/activity-count/{{establishmentSearch || 'any'}}/{{new_tenant_id}}/{{selectedPlaceId}}/{{selectedEstablishmentId}}/"
                       headers='{"Accept": "application/json"}'
                       handleas="json"
                       on-core-response="{{activitiesResponse}}"
                       on-core-error="{{ajaxError}}"
                       id="ajax_activities">
            </core-ajax>
            <core-ajax url="/api/summary/agreement-count/{{new_tenant_id}}/{{selectedPlaceId}}/{{selectedEstablishmentId}}/"
                       headers='{"Accept": "application/json"}'
                       handleas="json"
                       on-core-response="{{agreementsResponse}}"
                       on-core-error="{{ajaxError}}"
                       id="ajax_agreements">
            </core-ajax>
            <core-ajax url="/api/summary/degree-count/{{new_tenant_id}}/{{selectedPlaceId}}/{{selectedEstablishmentId}}/"
                       headers='{"Accept": "application/json"}'
                       handleas="json"
                       on-core-response="{{degreesResponse}}"
                       on-core-error="{{ajaxError}}"
                       id="ajax_degrees">
            </core-ajax>
            <core-ajax url="/api/establishments/list/{{establishmentSearch}}/"
                       headers='{"Accept": "application/json"}'
                       handleas="json"
                       on-core-response="{{establishmentResponse}}"
                       on-core-error="{{ajaxError}}"
                       id="ajax_establishmentsList">
            </core-ajax>
            <core-ajax url="/api/establishments/{{tenant_id}}/offspring/"
                       headers='{"Accept": "application/json"}'
                       handleas="json"
                       auto
                       on-core-response="{{affiliations_response}}"
                       on-core-error="{{ajaxError}}"
                       id="ajax_affiliations">
            </core-ajax>
            <!--<core-ajax url="/api/international-affiliations/Affiliation-count/{{new_tenant_id}}/{{selectedPlaceId}}/"
                   handleas="json" auto
                   on-core-response="{{affiliationsResponse}}"
                   on-core-error="{{ajaxError}}"
                   id="ajax_degrees">
        </core-ajax>
        <core-ajax url="/api/geographic-expertise/expertise-count/{{new_tenant_id}}/{{selectedPlaceId}}/"
                   handleas="json" auto
                   on-core-response="{{expertisesResponse}}"
                   on-core-error="{{ajaxError}}"
                   id="ajax_degrees">
        </core-ajax>-->
            <core-localstorage i
            <core-localstorage id="affiliations" name="affiliations" value="{{affiliations}}"></core-localstorage>

</template>
    <script src="report.js"></script>

</polymer-element>


